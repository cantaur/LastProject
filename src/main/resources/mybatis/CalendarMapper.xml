<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.pium.mapper.CalendarMapper">


    <!--Memo insert-->
     <insert id="insertCalMemo" parameterType="CalendarDTO">
        INSERT INTO calendar (calendar_title, calendar_content, calendar_startdate, calendar_enddate, projmember_seq, project_seq)
        VALUES(#{calendar_title}, #{calendar_content}, #{calendar_startdate}, #{calendar_enddate}, #{projmember_seq}, #{project_seq})
    </insert>

<!--    이 프로젝트에서 생성된 모든 캘린더 목록 조회-->
    <select id="calListByProjSeq" resultType="CalendarDTO" parameterType="long">
        select * from calendar where project_seq=#{project_seq}
    </select>


    <!--해당 프로젝트에서 생성된 업무 리스트 조회(날짜 없는 데이터는 제외)-->
    <select id="taskListByProjSeq" parameterType="long" resultType="TaskDTO">
        <if test="task_startdate != null and !task_startdate.equals('') and task_duedate !=null and task_enddate != null">
        SELECT * FROM task WHERE project_seq = #{project_seq} </if>

    </select>















    <!-- 달력 리스트 BySeq 출력 -->
    <select id="calListBySeq" resultType="CalendarDTO" parameterType="long">
        select *from calendar
        where calendar_seq=#{calendar_seq}
    </select>





    <!-- 달력 리스트 ByProSeq 출력 -->
    <select id="calListByProSeq" resultType="CalendarDTO" parameterType="long">
        select *from calendar
        where projmember_seq=#{projmember_seq}
    </select>

    <!-- 달력 제목 수정 -->
    <update id ="upCalName" parameterType="CalendarDTO">
        update calender
        set calendar_title = #{calendar_title}
        where calendar_seq = #{calendar_seq}
    </update>

    <!-- 달력 내용 수정 -->
    <update id="upCalContent" parameterType="CalendarDTO">
        update calendar
        set calendar_content = #{calendar_content}
        where calendar_seq = #{calendar_seq}
    </update>

    <!-- 달력 날짜 수정-->
    <update id="upCalDate" parameterType="CalendarDTO">
        update calendar
        set calendar_date = #{calendar_date}
        where calendar_seq = #{calendar_seq}
    </update>

    <!-- 달력 startdate 수정-->
    <update id="upCalSdate" parameterType="CalendarDTO">
        update calendar
        set calendar_startdate = #{calendar_startdate}
        where calendar_seq = #{calendar_seq}
    </update>

    <!-- 달력 enddate 수정-->
    <update id="upCalEdate" parameterType="CalendarDTO">
        update calendar
        set calendar_enddate = #{calendar_enddate}
        where calendar_seq = #{calendar_seq}
    </update>

    <!-- 달력 delete 는 project 안에서 삭제하면 없어짐 -->
    <!-- 달력 자체에서 삭제하고 싶다면 projectManager 권한 확인 하고 삭제 할 수 있게 구현해야 함-->
    <!-- 이건 내일 이야기 해보기-->
    <delete id = "delCal" parameterType="long">
        DELETE FROM calendar
        WHERE calendar_seq = #{calendar_seq}
    </delete>

</mapper>